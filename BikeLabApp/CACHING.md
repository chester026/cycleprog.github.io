# üíæ Caching Strategy –¥–ª—è BikeLab iOS App

## üì¶ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ò—Å–ø–æ–ª—å–∑—É–µ–º **AsyncStorage** + –∫–∞—Å—Ç–æ–º–Ω–∞—è —É—Ç–∏–ª–∏—Ç–∞ `Cache` –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.

---

## üéØ –ß—Ç–æ –∫–µ—à–∏—Ä—É–µ—Ç—Å—è

### **Activities List**
- **–ö–ª—é—á:** `activities_list`
- **TTL:** 30 –º–∏–Ω—É—Ç (HALF_HOUR)
- **–ü–æ—á–µ–º—É 30 –º–∏–Ω—É—Ç:** –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ä–µ–¥–∫–æ –º–µ–Ω—è—é—Ç—Å—è (—Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ + —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è), pull-to-refresh –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- **–õ–æ–≥–∏–∫–∞:**
  1. –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —ç–∫—Ä–∞–Ω–∞ ‚Üí –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ –∫–µ—à–∞ (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ)
  2. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ–º —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ API
  3. –û–±–Ω–æ–≤–ª—è–µ–º UI + —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫–µ—à
  4. –ü—Ä–∏ pull-to-refresh ‚Üí –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–µ—à, –∑–∞–≥—Ä—É–∂–∞–µ–º —Å–≤–µ–∂–∏–µ

### **–í –±—É–¥—É—â–µ–º:**
- User Profile (1 —á–∞—Å) ‚Äî —Ä–µ–¥–∫–æ –º–µ–Ω—è–µ—Ç—Å—è
- Activity Details (15 –º–∏–Ω—É—Ç) ‚Äî —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–µ–∑–¥–∞
- Skills History (30 –º–∏–Ω—É—Ç) ‚Äî –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –Ω–æ–≤—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫

---

## ‚è±Ô∏è Time To Live (TTL)

```typescript
CACHE_TTL = {
  SHORT: 2 –º–∏–Ω—É—Ç—ã,      // –¥–ª—è —á–∞—Å—Ç–æ –º–µ–Ω—è—é—â–∏—Ö—Å—è –¥–∞–Ω–Ω—ã—Ö
  MEDIUM: 5 –º–∏–Ω—É—Ç,      // —É–º–µ—Ä–µ–Ω–Ω–æ –º–µ–Ω—è—é—â–∏–µ—Å—è
  LONG: 15 –º–∏–Ω—É—Ç,       // activity details
  HALF_HOUR: 30 –º–∏–Ω—É—Ç,  // activities list (—Ä–µ–¥–∫–æ –º–µ–Ω—è—é—Ç—Å—è)
  HOUR: 1 —á–∞—Å,          // user profile, stats
  DAY: 1 –¥–µ–Ω—å,          // —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
}
```

---

## üîß API

### **–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫–µ—à:**
```typescript
await Cache.set('activities_list', data, CACHE_TTL.HALF_HOUR);
```

### **–ü–æ–ª—É—á–∏—Ç—å –∏–∑ –∫–µ—à–∞:**
```typescript
const cached = await Cache.get<Activity[]>('activities_list');
if (cached) {
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
}
```

### **–£–¥–∞–ª–∏—Ç—å –∏–∑ –∫–µ—à–∞:**
```typescript
await Cache.remove('activities_list');
```

### **–û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–µ—à:**
```typescript
await Cache.clear();
```

### **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–µ—à–µ:**
```typescript
const info = await Cache.getInfo();
console.log(`Cached items: ${info.count}`);
console.log(`Keys: ${info.keys.join(', ')}`);
```

---

## üé® UX

- **–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** –∏–∑ –∫–µ—à–∞ ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—Ä–∞–∑—É –≤–∏–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ
- **–§–æ–Ω–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** ‚Üí —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è –Ω–µ–∑–∞–º–µ—Ç–Ω–æ
- **Pull-to-refresh** ‚Üí –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –∫–µ—à)
- **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∫–µ—à–∞** ‚Üí "üì¶ from cache" (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, –ø–æ–∫–∞ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–µ—à–∞)

---

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. ‚úÖ **–ú–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Strava API** ‚Üí –Ω–µ —É–ø–∏—Ä–∞–µ–º—Å—è –≤ –ª–∏–º–∏—Ç—ã
2. ‚úÖ **–ë—ã—Å—Ç—Ä—ã–π UI** ‚Üí –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –∫–µ—à–∞
3. ‚úÖ **–û—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º** ‚Üí –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
4. ‚úÖ **–ú–µ–Ω—å—à–µ —Ç—Ä–∞—Ñ–∏–∫–∞** ‚Üí —ç–∫–æ–Ω–æ–º–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫–µ—à–µ–º –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å:

```
üíæ Cached: activities_list (expires in 300s)
‚úÖ Cache hit: activities_list (age: 45s)
‚è∞ Cache expired: activities_list (age: 320s)
üì≠ Cache miss: activities_list
üóëÔ∏è Cache removed: activities_list
```

---

## üîÑ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### **Activities Screen:**
```
1. –û—Ç–∫—Ä—ã—Ç–∏–µ ‚Üí –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –∫–µ—à–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
2. –§–æ–Ω–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ API
3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI + –∫–µ—à–∞
4. Pull-to-refresh ‚Üí –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –∫–µ—à, –≤—Å–µ–≥–¥–∞ —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ
```

### **–í –±—É–¥—É—â–µ–º (Activity Details):**
```
1. –û—Ç–∫—Ä—ã—Ç–∏–µ ‚Üí –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –∫–µ—à–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
2. –ï—Å–ª–∏ –∫–µ—à–∞ –Ω–µ—Ç –∏–ª–∏ –∏—Å—Ç–µ–∫ ‚Üí –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ API
3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–µ—à (15 –º–∏–Ω—É—Ç)
```

---

## ‚ö° Performance

- **Cache hit:** < 10ms
- **Cache miss + API call:** 500-2000ms
- **–†–∞–∑–º–µ—Ä –∫–µ—à–∞:** ~50-100 KB –¥–ª—è 100+ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π

---

## üõ†Ô∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–µ—à —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –û—Ç–∫—Ä–æ–π Activities ‚Üí –¥–æ–ª–∂–Ω—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ (–ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞)
2. –ó–∞–∫—Ä–æ–π –∏ –æ—Ç–∫—Ä–æ–π —Å–Ω–æ–≤–∞ ‚Üí –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "üì¶ from cache"
3. Pull-to-refresh ‚Üí –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∫–µ—à–∞ –¥–æ–ª–∂–µ–Ω –∏—Å—á–µ–∑–Ω—É—Ç—å

### **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å TTL:**
1. –ü–æ–¥–æ–∂–¥–∏ 5+ –º–∏–Ω—É—Ç
2. –û—Ç–∫—Ä–æ–π Activities ‚Üí –∫–µ—à –∏—Å—Ç–µ—á–µ—Ç, –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ API

### **–û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –≤—Ä—É—á–Ω—É—é:**
```typescript
import {Cache} from './src/utils/cache';
await Cache.clear();
```

