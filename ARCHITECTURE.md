# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ CycleProg

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã](#–æ–±–∑–æ—Ä-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)
2. [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã](#–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã-—Å–∏—Å—Ç–µ–º—ã)
3. [–ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö](#–ø–æ—Ç–æ–∫–∏-–¥–∞–Ω–Ω—ã—Ö)
4. [–°–∏—Å—Ç–µ–º–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è](#—Å–∏—Å—Ç–µ–º–∞-–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è)
5. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
6. [API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã](#api-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã)
7. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
8. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
9. [–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ](#—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)

---

## üéØ –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Frontend      ‚îÇ    ‚îÇ    Backend      ‚îÇ    ‚îÇ   External      ‚îÇ
‚îÇ   (React SPA)   ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   (Node.js)     ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   APIs          ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ
‚îÇ ‚Ä¢ localStorage  ‚îÇ    ‚îÇ ‚Ä¢ PostgreSQL    ‚îÇ    ‚îÇ ‚Ä¢ Strava API    ‚îÇ
‚îÇ ‚Ä¢ Session Mgmt  ‚îÇ    ‚îÇ ‚Ä¢ Redis Cache   ‚îÇ    ‚îÇ ‚Ä¢ Weather API   ‚îÇ
‚îÇ ‚Ä¢ UI Components ‚îÇ    ‚îÇ ‚Ä¢ File Storage  ‚îÇ    ‚îÇ ‚Ä¢ Maps API      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫:**

#### **Frontend:**
- **React 18** - UI —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **Vite** - —Å–±–æ—Ä—â–∏–∫ –∏ dev —Å–µ—Ä–≤–µ—Ä
- **Recharts** - –≥—Ä–∞—Ñ–∏–∫–∏ –∏ –¥–∏–∞–≥—Ä–∞–º–º—ã
- **CSS3** - —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è

#### **Backend:**
- **Node.js** - —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞
- **Express.js** - –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **PostgreSQL** - –æ—Å–Ω–æ–≤–Ω–∞—è –ë–î
- **JWT** - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

#### **External APIs:**
- **Strava API** - –¥–∞–Ω–Ω—ã–µ –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö
- **Open-Meteo** - –ø–æ–≥–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- **Google Maps** - –∫–∞—Ä—Ç—ã –∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è

---

## üß© –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### **Frontend (React SPA)**

#### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫:**
```
react-spa/src/
‚îú‚îÄ‚îÄ components/          # –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ charts/         # –ì—Ä–∞—Ñ–∏–∫–∏ –∏ –¥–∏–∞–≥—Ä–∞–º–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ ui/             # UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ blocks/         # –ë–ª–æ–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü
‚îú‚îÄ‚îÄ pages/              # –°—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ utils/              # –£—Ç–∏–ª–∏—Ç—ã –∏ —Ö–µ–ª–ø–µ—Ä—ã
‚îú‚îÄ‚îÄ assets/             # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—Å—É—Ä—Å—ã
‚îî‚îÄ‚îÄ styles/             # CSS —Ñ–∞–π–ª—ã
```

#### **–ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- **`PlanPage`** - –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
- **`TrainingsPage`** - —Å–ø–∏—Å–æ–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
- **`GaragePage`** - –≥–∞—Ä–∞–∂ –≤–µ–ª–æ—Å–∏–ø–µ–¥–æ–≤
- **`AdminPage`** - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å
- **`DatabaseMemoryInfo`** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ë–î

### **Backend (Node.js)**

#### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫:**
```
server/
‚îú‚îÄ‚îÄ server.js           # –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ database_profiles.js # –ü—Ä–æ—Ñ–∏–ª–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ PostgreSQL
‚îú‚îÄ‚îÄ apply_profile.js    # –°–∫—Ä–∏–ø—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π
‚îú‚îÄ‚îÄ aiAnalysis.js       # AI –∞–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
‚îú‚îÄ‚îÄ public/             # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
‚îî‚îÄ‚îÄ strava_tokens.json  # –¢–æ–∫–µ–Ω—ã Strava
```

#### **–ö–ª—é—á–µ–≤—ã–µ –º–æ–¥—É–ª–∏:**
- **Express —Å–µ—Ä–≤–µ—Ä** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- **PostgreSQL Pool** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏ —Å –ë–î
- **JWT Middleware** - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **Strava Integration** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Strava API

---

## üîÑ –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### **1. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

```mermaid
sequenceDiagram
    participant U as User
    participant F as Frontend
    participant B as Backend
    participant S as Strava API
    participant DB as PostgreSQL

    U->>F: –í–≤–æ–¥ email/password
    F->>B: POST /api/login
    B->>DB: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    DB-->>B: User data
    B->>S: –ü–æ–ª—É—á–µ–Ω–∏–µ Strava —Ç–æ–∫–µ–Ω–∞
    S-->>B: Access token
    B->>F: JWT token
    F->>F: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage
```

### **2. –ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫**

```mermaid
sequenceDiagram
    participant F as Frontend
    participant B as Backend
    participant S as Strava API
    participant DB as PostgreSQL
    participant C as Cache

    F->>C: –ü—Ä–æ–≤–µ—Ä–∫–∞ localStorage
    alt –î–∞–Ω–Ω—ã–µ –≤ –∫—ç—à–µ
        C-->>F: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    else –ù–µ—Ç –∫—ç—à–∞
        F->>B: GET /api/activities
        B->>S: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
        S-->>B: Activities data
        B->>DB: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
        B->>F: Activities data
        F->>C: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫—ç—à
    end
```

### **3. –ê–Ω–∞–ª–∏–∑ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤**

```mermaid
sequenceDiagram
    participant F as Frontend
    participant B as Backend
    participant S as Strava API
    participant C as Cache

    F->>C: –ü—Ä–æ–≤–µ—Ä–∫–∞ streams –∫—ç—à–∞
    alt Streams –≤ –∫—ç—à–µ
        C-->>F: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ streams
    else –ù–µ—Ç –∫—ç—à–∞
        F->>B: GET /api/activities/{id}/streams
        B->>S: –ü–æ–ª—É—á–µ–Ω–∏–µ streams
        S-->>B: Streams data
        B->>F: Streams data
        F->>C: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ streams (500KB limit)
    end
    F->>F: –ê–Ω–∞–ª–∏–∑ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
```

### **4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è PostgreSQL**

```mermaid
sequenceDiagram
    participant A as Admin
    participant F as Frontend
    participant B as Backend
    participant DB as PostgreSQL

    A->>F: –í—ã–±–æ—Ä –ø—Ä–æ—Ñ–∏–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
    F->>B: POST /api/database/optimize
    B->>DB: ALTER SYSTEM SET
    alt –£—Å–ø–µ—Ö
        DB-->>B: Success
        B->>F: Applied settings
    else –û—à–∏–±–∫–∞ –ø—Ä–∞–≤
        B->>DB: SET (session only)
        DB-->>B: Session applied
        B->>F: Session only applied
    end
```

---

## üíæ –°–∏—Å—Ç–µ–º–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

### **3-—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Frontend      ‚îÇ    ‚îÇ    Backend      ‚îÇ    ‚îÇ   PostgreSQL    ‚îÇ
‚îÇ  localStorage   ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   In-Memory     ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   Shared        ‚îÇ
‚îÇ   (30 –º–∏–Ω TTL)  ‚îÇ    ‚îÇ     Cache       ‚îÇ    ‚îÇ   Buffers       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **Frontend –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (localStorage):**

#### **–ö—ç—à–∏—Ä—É–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```javascript
// –ö–ª—é—á–∏ –∫—ç—à–∞
const CACHE_KEYS = {
  ACTIVITIES: 'activities',           // –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (30 –º–∏–Ω)
  GARAGE_IMAGES: 'garage_images',     // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥–∞—Ä–∞–∂–∞ (1 —á–∞—Å)
  WEATHER_DATA: 'weather_data',       // –ü–æ–≥–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (30 –º–∏–Ω)
  HERO_IMAGES: 'hero_images',         // Hero –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (5 –º–∏–Ω)
  STREAMS: 'streams_${activityId}'    // –î–∞–Ω–Ω—ã–µ –ø–æ—Ç–æ–∫–æ–≤ (7 –¥–Ω–µ–π, 500KB)
};
```

#### **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—ç—à–µ–º:**
```javascript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞
cleanupOldStreamsCache() // –£–¥–∞–ª—è–µ—Ç streams —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π

// TTL (Time To Live)
const DEFAULT_TTL = 30 * 60 * 1000; // 30 –º–∏–Ω—É—Ç

// –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞
const STREAMS_SIZE_LIMIT = 500000; // 500KB –¥–ª—è streams
```

### **Backend –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**

#### **In-Memory –∫—ç—à:**
- **Hero –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è** - 5 –º–∏–Ω—É—Ç TTL
- **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** - –∫—ç—à–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- **Strava —Ç–æ–∫–µ–Ω—ã** - –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

#### **PostgreSQL –∫—ç—à:**
- **Shared buffers** - –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π —Ä–∞–∑–º–µ—Ä
- **Effective cache size** - –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—Ä–æ—Å–æ–≤
- **Work memory** - –ø–∞–º—è—Ç—å –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### **PostgreSQL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**

#### **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:**
```javascript
const pool = new Pool({
  host: process.env.PGHOST,
  user: process.env.PGUSER,
  password: process.env.PGPASSWORD,
  database: process.env.PGDATABASE,
  port: process.env.PGPORT,
  ssl: isProduction ? { rejectUnauthorized: false } : false
});
```

#### **–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**
```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
users (id, email, password_hash, strava_id, created_at)

-- –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
activities (id, user_id, strava_id, name, distance, duration, ...)

-- –†—É—á–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
rides (id, user_id, title, location, details, start, created_at)

-- –ß–µ–∫–ª–∏—Å—Ç
checklist (id, user_id, section, item, checked, created_at)

-- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ü–µ–ª–∏
goals (id, user_id, title, description, target_value, current_value, unit, goal_type, period, created_at, updated_at)

-- –¢–æ–∫–µ–Ω—ã Strava
strava_tokens (user_id, access_token, refresh_token, expires_at)

-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
settings (key, value, updated_at)
```

### **–ü—Ä–æ—Ñ–∏–ª–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**

#### **–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏:**
| –ü—Ä–æ—Ñ–∏–ª—å | RAM | Max Connections | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-----|-----------------|----------|
| `low-end` | 256 MB | 10 | –û—á–µ–Ω—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã |
| `medium` | 1 GB | 50 | –°—Ä–µ–¥–Ω–∏–µ —Ä–µ—Å—É—Ä—Å—ã |
| `high-end` | 4 GB | 200 | –ú–æ—â–Ω—ã–π —Å–µ—Ä–≤–µ—Ä |
| `enterprise` | 16 GB | 500 | –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π —Å–µ—Ä–≤–µ—Ä |

#### **–ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
```sql
-- Low-end –ø—Ä–æ—Ñ–∏–ª—å (256 MB RAM)
shared_buffers: 16MB              -- 6% –æ—Ç RAM
effective_cache_size: 128MB       -- 50% –æ—Ç RAM
work_mem: 512kB                   -- –ü–∞–º—è—Ç—å –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é
maintenance_work_mem: 2MB         -- –ü–∞–º—è—Ç—å –¥–ª—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
max_connections: 10               -- –ú–∞–∫—Å–∏–º—É–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
```

---

## üîå API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:**
```
POST   /api/login                 # –í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
POST   /api/register              # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
GET    /api/auth/verify           # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
```

### **–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏:**
```
GET    /api/activities            # –°–ø–∏—Å–æ–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
GET    /api/activities/:id        # –î–µ—Ç–∞–ª–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
GET    /api/activities/:id/streams # –î–∞–Ω–Ω—ã–µ –ø–æ—Ç–æ–∫–æ–≤
POST   /api/activities            # –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
PUT    /api/activities/:id        # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
DELETE /api/activities/:id        # –£–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
```

### **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞:**
```
GET    /api/analytics/summary     # –û–±—â–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
GET    /api/analytics/intervals   # –ê–Ω–∞–ª–∏–∑ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
GET    /api/analytics/vo2max      # VO2max –¥–∞–Ω–Ω—ã–µ
```

### **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```
GET    /api/admin/rides           # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º–∏
GET    /api/admin/garage          # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–∞—Ä–∞–∂–æ–º
GET    /api/admin/hero            # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ hero –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
GET    /api/admin/tokens          # –¢–æ–∫–µ–Ω—ã Strava
```

### **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**
```
GET    /api/database/memory       # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞–º—è—Ç–∏
GET    /api/database/table-stats  # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞–±–ª–∏—Ü
GET    /api/database/profiles     # –ü—Ä–æ—Ñ–∏–ª–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
POST   /api/database/optimize     # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
POST   /api/database/clear-cache  # –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
```

### **–í–Ω–µ—à–Ω–∏–µ API:**
```
GET    /api/strava/activities     # –ü—Ä–æ–∫—Å–∏ –∫ Strava API
GET    /api/weather               # –ü–æ–≥–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
GET    /api/maps/geocode          # –ì–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:**
- **JWT —Ç–æ–∫–µ–Ω—ã** - –¥–ª—è API –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **Session storage** - –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π
- **LocalStorage** - –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π
- **Strava OAuth** - –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Strava

### **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:**
```javascript
// Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤
const authMiddleware = (req, res, next) => {
  const token = req.headers.authorization?.split(' ')[1];
  if (!token) return res.status(401).json({ error: 'No token' });
  
  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    req.user = decoded;
    next();
  } catch (error) {
    res.status(401).json({ error: 'Invalid token' });
  }
};
```

### **–ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö:**
- **HTTPS** - —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞
- **SQL Injection** - –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- **XSS** - —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- **CSRF** - —Ç–æ–∫–µ–Ω—ã –¥–ª—è —Ñ–æ—Ä–º

### **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
PGHOST=localhost
PGUSER=postgres
PGPASSWORD=your_password
PGDATABASE=cycleprog
PGPORT=5432

# JWT
JWT_SECRET=your_jwt_secret

# Strava
STRAVA_CLIENT_ID=your_client_id
STRAVA_CLIENT_SECRET=your_client_secret

# –í–Ω–µ—à–Ω–∏–µ API
WEATHER_API_KEY=your_weather_api_key
MAPS_API_KEY=your_maps_api_key
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### **Frontend –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
- **CacheStatus** - —Å—Ç–∞—Ç—É—Å –∫—ç—à–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **Error boundaries** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ React
- **Performance monitoring** - –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### **Backend –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
- **DatabaseMemoryInfo** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ PostgreSQL
- **API rate limiting** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- **Error logging** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

### **–ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
```javascript
// –ö—ç—à hit ratio
const cacheHitRatio = (hits / (hits + misses)) * 100;

// –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API
const responseTime = Date.now() - startTime;

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
const memoryUsage = process.memoryUsage();
```

### **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```javascript
// –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏
console.log({
  level: 'info',
  message: 'API request processed',
  endpoint: req.path,
  method: req.method,
  responseTime: Date.now() - startTime,
  userAgent: req.headers['user-agent']
});
```

---

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É:**

#### **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ:**
- **RAM:** 256 MB
- **CPU:** 0.1 vCPU
- **Storage:** 1 GB
- **OS:** Linux (Ubuntu/Debian)

#### **–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ:**
- **RAM:** 1 GB+
- **CPU:** 1 vCPU+
- **Storage:** 10 GB+
- **OS:** Ubuntu 20.04+

### **–£—Å—Ç–∞–Ω–æ–≤–∫–∞:**

#### **1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:**
```bash
git clone https://github.com/your-username/cycleprog.github.io.git
cd cycleprog.github.io
```

#### **2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**
```bash
# Frontend
cd react-spa
npm install
npm run build

# Backend
cd ../server
npm install
```

#### **3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
sudo -u postgres createdb cycleprog

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
psql -d cycleprog -f migrations/init.sql

# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è PostgreSQL
sudo -u postgres node apply_profile.js low-end
sudo systemctl restart postgresql
```

#### **4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞
cp .env.example .env
nano .env

# –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
PGHOST=localhost
PGUSER=postgres
PGPASSWORD=your_password
PGDATABASE=cycleprog
JWT_SECRET=your_secret_key
STRAVA_CLIENT_ID=your_strava_client_id
STRAVA_CLIENT_SECRET=your_strava_client_secret
```

#### **5. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
```bash
# Development
npm run dev

# Production
npm start
```

### **Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```nginx
server {
    listen 80;
    server_name your-domain.com;

    # Frontend
    location / {
        root /path/to/react-spa/dist;
        try_files $uri $uri/ /index.html;
    }

    # Backend API
    location /api {
        proxy_pass http://localhost:8080;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
    location /img {
        alias /path/to/public/img;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

### **SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç:**
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Certbot
sudo apt install certbot python3-certbot-nginx

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
sudo certbot --nginx -d your-domain.com

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
sudo crontab -e
# –î–æ–±–∞–≤–∏—Ç—å: 0 12 * * * /usr/bin/certbot renew --quiet
```

---

## üîß –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### **–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏:**
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫
- **–û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞** - —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–ë—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** - —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

### **–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏:**
- **–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** - –º–µ—Ç—Ä–∏–∫–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** - npm audit –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** - —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π

### **–ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –∑–∞–¥–∞—á–∏:**
- **–û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã** - –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É–ª—É—á—à–µ–Ω–∏–π
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU/RAM/Storage
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏** - –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- [PostgreSQL Optimization Guide](server/POSTGRES_OPTIMIZATION.md)
- [API Documentation](API.md)
- [Deployment Guide](DEPLOYMENT.md)

### **–ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ PostgreSQL
psql -c "SELECT name, setting, unit FROM pg_settings WHERE name IN ('shared_buffers', 'effective_cache_size', 'work_mem');"

# –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
curl -X POST http://localhost:8080/api/database/clear-cache

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
sudo -u postgres node apply_profile.js low-end

# –ë—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
pg_dump cycleprog > backup_$(date +%Y%m%d).sql
```

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞: $(date)* 